@using Cinema.Data.Models;
@using Cinema.ViewModels.Users;
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> _userManager;

<div class="sidebar">
    <div class="sidebar-header">
        <div class="app-icon">
            CTLogo
        </div>
    </div>
    <ul class="sidebar-list" id="myTab" role="tablist">
        <li class="sidebar-list-item">
           @if (User.IsInRole("Owner"))
            {
                <a id="home-tab" asp-controller="Owners" asp-action="Index">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>
                    <span>Home</span>
                </a>
            }
            else if(User.IsInRole("Administrator"))
            {
                <a id="home-tab" asp-controller="Admin" asp-action="Index">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>
                    <span>Home</span>
                </a>
            }
        </li>
        <li class="sidebar-list-item">
            @if (User.IsInRole("Owner"))
            {
                <a id="cinemas-tab" asp-controller="Owners" asp-action="UserCinemas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-bag"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" /><line x1="3" y1="6" x2="21" y2="6" /><path d="M16 10a4 4 0 0 1-8 0" /></svg>
                    <span>Cinemas</span>
                </a>
            }
            else if (User.IsInRole("Administrator"))
            {
                <a id="cinemas-tab" asp-controller="Admin" asp-action="AllCinemas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-bag"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" /><line x1="3" y1="6" x2="21" y2="6" /><path d="M16 10a4 4 0 0 1-8 0" /></svg>
                    <span>Cinemas</span>
                </a>
            }
        </li>
        <li class="sidebar-list-item">
            @if (User.IsInRole("Owner"))
            {
                <a asp-controller="Movies" asp-action="AllMovies">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pie-chart"><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></svg>
                    <span>Movies</span>
                </a>
            }
            else if (User.IsInRole("Administrator"))
            {
                <a asp-controller="Admin" asp-action="Users">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pie-chart"><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></svg>
                    <span>Users</span>
                </a>
            }
        </li>
    </ul>
    @{
        var user = await _userManager.FindByEmailAsync(User.Identity.Name);
        var viewModel = new SidebarUserViewModel
            {
                Name = $"{user.FirstName} {user.LastName}",
                ImageUrl = user.ProfilePictureUrl
            };
        await Html.RenderPartialAsync("_ProfileInfoPartial", viewModel);
    }
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script>
    $(function () {
        // this will get the full URL at the address bar
        var url = window.location.href;
        // passes on every "a" tag
        $(".sidebar-list li a").each(function () {

            // checks if its the same on the address bar
            if (url == (this.href)) {

                $(this).closest("li").addClass("active");
                //for making parent of submenu active
                $(this).closest("li").parent().parent().addClass("active");
            }
        });
    });
</script>