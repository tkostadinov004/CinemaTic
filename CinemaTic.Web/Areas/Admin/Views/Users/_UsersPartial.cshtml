@model PaginatedList<CinemaTic.ViewModels.Admin.UserDetailsViewModel>

@foreach (var user in Model)
{
    <div class="cinema-row info-cinema">
        <button class="cell-more-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical"><circle cx="12" cy="12" r="1" /><circle cx="12" cy="5" r="1" /><circle cx="12" cy="19" r="1" /></svg>
        </button>
        <div class="cinema-cell image" title="@user.FullName">
            <a class="d-flex align-items-center cinema-link" asp-area="Admin" asp-controller="Users" asp-action="User" asp-route-id="@user.Id">
                <img class="circle-image" src="~/client-images/Users/@user.ImageUrl" alt="cinema-logo">
                <span>@user.FullName</span>
            </a>
        </div>
        <div class="cinema-cell status-cell">
            <span class="cell-label">Email:</span>
            <span>@user.UserName</span>
        </div>
        <div class="cinema-cell added-by">
            <span class="cell-label">Roles:</span>
            <span>@user.Roles</span>
        </div>
        <div class="cinema-cell added-by">
            <span class="cell-label">Admin actions:</span>
            <div class="admin-actions" id="@user.Id">
                @if (user.Roles.Contains("Owner"))
                {
                    <button class="demote open-popup-btn" title="Demote">
                        <i class="fa-solid fa-user orange"></i>
                        Demote
                    </button>
                }
                else if (user.Roles.Contains("Customer"))
                {
                    <button class="promote open-popup-btn" title="Promote to owner">
                        <i class="fa-solid fa-user green"></i>
                        Promote to owner
                    </button>
                }
                <button class="delete open-popup-btn" title="Delete account">
                    <i class="fa-solid fa-user text-danger"></i>
                    Delete account
                </button>
            </div>
        </div>
    </div>
}
@{
    var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
    var nextDisabled = !Model.HasNextPage ? "disabled" : "";
}
@if(Model.TotalPages > 1)
{
    <ul class="pagination gap-1">
        <li class="page-item">
            <a class="action-button active previous @prevDisabled">
                Previous
            </a>
        </li>
        <li class="page-item">
            <a class="action-button active next @nextDisabled">
                Next
            </a>
        </li>
    </ul>
}
<script>
    document.querySelectorAll('.page-item a').forEach(i => i.addEventListener("click", function () {
        if (i.classList.contains("previous")) {
            page = page - 1;
        }
        else if (i.classList.contains("next")) {
            page = page + 1;
        }
        getItems('Admin', 'Users', 'QueryUsers',page, search.value, (filterOptions ? filterOptions.value : null), (activeSort ? activeSort.id : null));
    }));
</script>
<script>
    openButtons = document.querySelectorAll('.open-popup-btn');
    modal = document.getElementById('modal');
    modalOverlay = document.querySelector('.modal-overlay');
    openButtons.forEach(i => i.addEventListener('click', openModal));

    var modalContainer = document.getElementById('ud-form-container');

    var promoteButton = document.querySelectorAll(".promote");
    promoteButton.forEach(i => i.addEventListener("click", function () {
        console.log(1);
        modalContainer.innerHTML = "";
        getUDpartial('Admin', 'Users', 'PromoteToOwner', i.parentElement.id);
    }));

    var demoteButton = document.querySelectorAll(".demote");
    demoteButton.forEach(i => i.addEventListener("click", function () {
        modalContainer.innerHTML = "";
        getUDpartial('Admin', 'Users', 'DemoteUser', i.parentElement.id);
    }));

    var deleteButton = document.querySelectorAll(".delete");
    deleteButton.forEach(i => i.addEventListener("click", function () {
        console.log(3);
        modalContainer.innerHTML = "";
        getUDpartial('Admin', 'Users', 'DeleteUserAccount', i.parentElement.id);
    }));
</script>